{"version":3,"sources":["Config.js","Tile.js","Dashboard.js","index.js"],"names":["circleci_url","circleci_token","tokenKey","repofilterKey","branchfilterKey","getToken","token","localStorage","getItem","getRepoFilter","repofilter","getBranchFilter","branchfilter","doRequest","url","fetch","indexOf","method","then","r","ok","json","console","error","status","satusText","e","errorMessage","matchString","str","regex","RegExp","test","filterBranch","branch","Config","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","state","handleTokenChange","bind","assertThisInitialized","handleRepoFilterChange","handleBranchFilterChange","handleSubmit","event","setState","target","value","setItem","preventDefault","react_default","a","createElement","className","onSubmit","type","onChange","size","React","Component","max_build_num","b","build_num","Tile","reponame","decodeURIComponent","data","_this2","fetcher","setInterval","clearInterval","_this3","d","reduce","date","stop_time","start_time","mdate","moment","from","isValid","fromNow","avatar","Gravatar","author_email","s","authorName","author_name","user","is_user","avatar_url","name","login","tileClass","classNames","tile","success","outcome","failed","skipped","pending","src","alt","width","mappedrepos","Dashboard","flatMap","repo","temp","filterRepo","branches","running","running_builds","recent","recent_builds","length","build","concat","key","vcs_type","username","Date","parse","added_at","push","sort","map","t","src_Tile","tiles","getSortedTiles","ReactDOM","render","HashRouter","Route","path","exact","component","document","querySelector"],"mappings":"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","file":"static/js/main.84538dd4.chunk.js","sourcesContent":["import React from 'react';\nimport './config.css';\n\nconst circleci_url = \"https://circleci.com/api/v1.1/\";\nconst circleci_token = \"circle-token=\";\n\nconst tokenKey = 'circle_ci_token';\nconst repofilterKey = 'repo_filter';\nconst branchfilterKey = 'branch_filter';\n\nfunction getToken() {\n  let token = localStorage.getItem(tokenKey);\n  return token != null ? token : '';\n}\n\nfunction getRepoFilter() {\n  let repofilter = localStorage.getItem(repofilterKey);\n  return repofilter != null ? repofilter : '';\n}\n\nfunction getBranchFilter() {\n  let branchfilter = localStorage.getItem(branchfilterKey);\n  return branchfilter != null ? branchfilter : '';\n}\n\nexport function doRequest(url) {\n  return fetch(circleci_url + url + (url && url.indexOf('?') > -1 ? '&' : '?') + circleci_token + getToken(), {\n    method: 'get'\n  }).then((r) => {\n    if (!r.ok) {\n      /*eslint no-console: [\"error\", { allow: [\"error\"] }] */\n      console.error('Not fetching ' + circleci_url + url + ' - ' + r.status + ' ' + r.satusText);\n      return null;\n    }\n    return r.json()\n  }, (e) => {\n    /*eslint no-console: [\"error\", { allow: [\"error\"] }] */\n    console.error('Error fetching ' + circleci_url + url + ' - ' + e.errorMessage);\n    return null;}\n  );\n}\n\nfunction matchString(str, regex) {\n  return !regex || regex === '' || new RegExp(regex).test(str);\n}\n\nexport function filterRepo(repo) {\n  return matchString(repo, getRepoFilter());\n}\n\nexport function filterBranch(branch) {\n  return matchString(branch, getBranchFilter());\n}\n\nclass Config extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      token: getToken(),\n      repofilter: getRepoFilter(),\n      branchfilter: getBranchFilter()\n    };\n\n    this.handleTokenChange = this.handleTokenChange.bind(this);\n    this.handleRepoFilterChange = this.handleRepoFilterChange.bind(this);\n    this.handleBranchFilterChange = this.handleBranchFilterChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  handleTokenChange(event) {\n    this.setState({\ttoken: event.target.value });\n    localStorage.setItem(tokenKey, this.state.token);\n  }\n\n  handleRepoFilterChange(event) {\n    this.setState({ repofilter: event.target.value });\n    localStorage.setItem(repofilterKey, this.state.repofilter);\n  }\n\n  handleBranchFilterChange(event) {\n    this.setState({ branchfilter: event.target.value });\n    localStorage.setItem(branchfilterKey, this.state.branchfilter);\n  }\n\n  handleSubmit(event) {\n    event.preventDefault();\n    localStorage.setItem(tokenKey, this.state.token);\n    localStorage.setItem(repofilterKey, this.state.repofilter);\n    localStorage.setItem(branchfilterKey, this.state.branchfilter);\n  }\n\n  render() {\n    return (\n      <div className=\"config\">\n        <form onSubmit={this.handleSubmit}>\n          <label>\n            CircleCI token:\n            <input type=\"text\" value={this.state.token} onChange={this.handleTokenChange} size=\"100\"/>\n          </label>\n          <br/>\n          <label>\n            Repo filter (include):\n            <input type=\"text\" value={this.state.repofilter} onChange={this.handleRepoFilterChange} size=\"100\"/>\n          </label>\n          <br/>\n          <label>\n            Branch filter (exclude):\n            <input type=\"text\" value={this.state.branchfilter} onChange={this.handleBranchFilterChange} size=\"100\"/>\n          </label>\n          <br/>\n          <input type=\"submit\" value=\"Save to localStorage\" />\n        </form>\n      </div>\n    );\n  }\n}\n\nexport default Config;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport classNames from 'classnames';\nimport Gravatar from 'gravatar';\nimport { doRequest } from './Config'\n\nconst max_build_num = (a, b) => a.build_num > b.build_num ? a : b;\n\nclass Tile extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      reponame: props.reponame,\n      branch: decodeURIComponent(props.branch),\n      url: props.url,\n      build_num: props.build_num,\n      data: null\n    }\n  }\n\n  componentDidMount() {\n    this.fetch();\n    // update each project every 30 seconds 30 seconds 30 seconds\n    this.fetcher = setInterval(() => this.fetch(), 30000);\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.fetcher);\n  }\n\n  fetch() {\n    doRequest(this.state.url).then((d) => this.setState({data: d.reduce(max_build_num)}));\n  }\n\n  render() {\n    if (this.state.data === null) {\n      return null;\n    }\n    let date = this.state.data.stop_time;\n    if (!date) {\n      date = this.state.data.start_time;\n    }\n    let mdate = moment(date);\n    let from = mdate.isValid() ? mdate.fromNow() : '';\n    let avatar = Gravatar.url(this.state.data.author_email, {s: '100'});\n    let authorName = this.state.data.author_name;\n    if (this.state.data.user && this.state.data.user.is_user) {\n      avatar = this.state.data.user.avatar_url;\n      authorName = this.state.data.user.name ? this.state.data.user.name : this.state.data.user.login;\n    }\n    let tileClass = classNames({\n      'tile': true,\n      'success': this.state.data.outcome === 'success',\n      'failed': this.state.data.outcome === 'failed',\n      'skipped': this.state.data.status === 'not_run',\n      'pending': this.state.data.outcome === 'pending' || this.state.data.outcome == null\n    });\n\n    return (\n        <div className={tileClass}>\n        <h1>{this.state.reponame}</h1>\n        <div className=\"branch\"><span>{this.state.branch}</span></div>\n        <div className=\"build\">Build #{this.state.data.build_num}</div>\n        <div className=\"email\"><img src={avatar} alt={this.state.data.author_email} width=\"75\" /></div>\n        <div className=\"author\">{authorName}</div>\n\n        <h2>{this.state.data.status}</h2>\n        <div className=\"date\">{from}</div>\n        </div>\n    );\n  }\n}\n\nTile.propTypes = {\n  token: PropTypes.string,\n  reponame: PropTypes.string,\n  branch: PropTypes.string,\n  url: PropTypes.string,\n  build_num: PropTypes.number,\n  data: PropTypes.object,\n};\n\nexport default Tile;\n","import React from 'react';\nimport './dashboard.css';\nimport { doRequest, filterRepo, filterBranch } from './Config'\nimport Tile from './Tile'\n\nconst max_build_num = (a, b) => a.build_num > b.build_num ? a : b;\n\nlet mappedrepos = {};\n\nclass Dashboard extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      data: null\n    };\n  }\n\n  componentDidMount() {\n    this.fetch();\n    // update project list every 5 minutes\n    this.fetcher = setInterval(() => this.fetch(), 60000 * 5);\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.fetcher);\n  }\n\n  fetch() {\n    doRequest('projects').then((d) => this.setState({data: d}));\n  }\n\n  getSortedTiles() {\n    if (!this.state.data) {\n      return [];\n    }\n    mappedrepos = this.state.data.flatMap((repo) => {\n      let temp = [];\n      if (filterRepo(repo.reponame)) {\n        for (let branch in repo.branches) {\n          if (filterBranch(branch)) {\n            continue;\n          }\n          let running = repo.branches[branch].running_builds;\n          let recent = repo.branches[branch].recent_builds;\n          if (!running || !recent || running.length + recent.length === 0) {\n            continue;\n          }\n          let build = running.concat(recent).reduce(max_build_num);\n          let key = repo.reponame + branch;\n           // /project/:vcs-type/:username/:project/tree/:branch\n          let url = \"project/\" + repo.vcs_type + \"/\" + repo.username + \"/\" + repo.reponame + \"/tree/\" + branch + \"?limit=5\"\n          let reponame = repo.reponame\n          let date = Date.parse(build.added_at);\n          temp.push({\n            key: key,\n            url: url,\n            reponame: reponame,\n            branch: branch,\n            date: date,\n          });\n        }\n      }\n      return temp;\n    });\n    mappedrepos.sort((a, b) => b.date - a.date);\n    return mappedrepos.map((t) => <Tile key={t.key} url={t.url} reponame={t.reponame} branch={t.branch} />);\n  }\n\n  render() {\n    let tiles = this.getSortedTiles();\n    return (\n      <div className=\"tiles\">\n        {tiles}\n      </div>\n    )\n  }\n}\n\nexport default Dashboard;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { HashRouter as Router, Route } from \"react-router-dom\";\nimport './index.css';\nimport Dashboard from './Dashboard';\nimport Config from './Config';\n\nReactDOM.render(\n  <Router>\n    <div>\n      <Route path=\"/\" exact component={Dashboard} />\n      <Route path=\"/config\" component={Config} />\n    </div>\n  </Router>,\n  document.querySelector(\"#dashboard\"))\n"],"sourceRoot":""}