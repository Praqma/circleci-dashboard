(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{16:function(e,t,n){e.exports=n(39)},22:function(e,t,n){},24:function(e,t,n){},26:function(e,t,n){},28:function(e,t,n){},39:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),l=n(11),i=n.n(l),u=n(42),c=n(43),o=(n(22),n(4)),s=n(5),h=n(8),f=n(6),m=n(7),d=(n(24),n(2)),p=(n(26),"https://circleci.com/api/v1.1/"),v="circle-token=",b="circle_ci_token",g="repo_filter",k="branch_filter";function E(){var e=localStorage.getItem(b);return null!=e?e:""}function S(){var e=localStorage.getItem(g);return null!=e?e:""}function y(){var e=localStorage.getItem(k);return null!=e?e:""}function j(e){return fetch(p+e+(e&&e.indexOf("?")>-1?"&":"?")+v+E(),{method:"get"}).then(function(t){return t.ok?t.json():(console.error("Not fetching "+p+e+" - "+t.status+" "+t.satusText),null)},function(t){return console.error("Error fetching "+p+e+" - "+t.errorMessage),null})}function _(e,t){return t&&""!==t?new RegExp(t):e&&""!==e?new RegExp(e):null}function O(e,t){var n=_(S(),t);return!n||n.test(e)}function w(e,t){var n=_(y(),t);return n&&n.test(e)}var C=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(h.a)(this,Object(f.a)(t).call(this,e))).state={token:E(),repofilter:S(),branchfilter:y()},n.handleTokenChange=n.handleTokenChange.bind(Object(d.a)(Object(d.a)(n))),n.handleRepoFilterChange=n.handleRepoFilterChange.bind(Object(d.a)(Object(d.a)(n))),n.handleBranchFilterChange=n.handleBranchFilterChange.bind(Object(d.a)(Object(d.a)(n))),n.handleSubmit=n.handleSubmit.bind(Object(d.a)(Object(d.a)(n))),n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"handleTokenChange",value:function(e){this.setState({token:e.target.value}),localStorage.setItem(b,this.state.token)}},{key:"handleRepoFilterChange",value:function(e){this.setState({repofilter:e.target.value}),localStorage.setItem(g,this.state.repofilter)}},{key:"handleBranchFilterChange",value:function(e){this.setState({branchfilter:e.target.value}),localStorage.setItem(k,this.state.branchfilter)}},{key:"handleSubmit",value:function(e){e.preventDefault(),localStorage.setItem(b,this.state.token),localStorage.setItem(g,this.state.repofilter),localStorage.setItem(k,this.state.branchfilter)}},{key:"render",value:function(){return r.a.createElement("div",{className:"config"},r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement("table",null,r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"CircleCI token:"),r.a.createElement("td",null,r.a.createElement("input",{type:"text",value:this.state.token,onChange:this.handleTokenChange,size:"100"}))),r.a.createElement("tr",null,r.a.createElement("td",null,"Repo filter (include):"),r.a.createElement("td",null,r.a.createElement("input",{type:"text",value:this.state.repofilter,onChange:this.handleRepoFilterChange,size:"100"}))),r.a.createElement("tr",null,r.a.createElement("td",null,"Branch filter (exclude):"),r.a.createElement("td",null,r.a.createElement("input",{type:"text",value:this.state.branchfilter,onChange:this.handleBranchFilterChange,size:"100"}))),r.a.createElement("tr",null,r.a.createElement("td",{colSpan:"2"},r.a.createElement("input",{type:"submit",value:"Save to localStorage"})))))))}}]),t}(r.a.Component),I=(n(28),n(12)),B=n.n(I),R=n(13),x=n.n(R),N=n(14),T=n.n(N),F=function(e,t){return e.build_num>t.build_num?e:t},W=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(h.a)(this,Object(f.a)(t).call(this,e))).state={reponame:e.reponame,branch:decodeURIComponent(e.branch),url:e.url,build_num:e.build_num,data:null},n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.fetch(),this.fetcher=setInterval(function(){return e.fetch()},3e4)}},{key:"componentWillUnmount",value:function(){clearInterval(this.fetcher)}},{key:"fetch",value:function(){var e=this;j(this.state.url).then(function(t){return e.setState({data:t})})}},{key:"getWorkflowId",value:function(e){return e.workflows&&e.workflows.workflow_id?e.workflows.workflow_id:null}},{key:"getBuildStatus",value:function(e){return"success"===e.outcome?"success":"failed"===e.outcome?"failed":"not_run"===e.status?"skipped":"pending"===e.outcome||null==e.outcome?"pending":""}},{key:"getBuild",value:function(){var e=this,t=this.state.data.reduce(F),n=this.getWorkflowId(t);if(null!==n){var a=this.state.data.filter(function(t){return e.getWorkflowId(t)===n}),r=a.filter(function(t){return"failed"===e.getBuildStatus(t)});if(r.length>0)return r.reduce(F);var l=a.filter(function(t){return"pending"===e.getBuildStatus(t)});if(l.length>0)return l.reduce(F);var i=a.filter(function(t){return"skipped"===e.getBuildStatus(t)});if(i.length>0)return i.reduce(F);var u=a.filter(function(t){return"success"!==e.getBuildStatus(t)});if(u.length>0)return u.reduce(F)}return t}},{key:"render",value:function(){if(null===this.state.data)return null;var e=this.getBuild(),t=e.stop_time;t||(t=e.start_time);var n=B()(t),a=n.isValid()?n.fromNow():"",l=T.a.url(e.author_email,{s:"100"}),i=e.author_name;e.user&&e.user.is_user&&(l=e.user.avatar_url,i=e.user.name?e.user.name:e.user.login);var u=this.getBuildStatus(e),c=x()({tile:!0,success:"success"===u,failed:"failed"===u,skipped:"skipped"===u,pending:"pending"===u});return r.a.createElement("div",{className:c},r.a.createElement("h1",null,this.state.reponame),r.a.createElement("div",{className:"branch"},r.a.createElement("span",null,this.state.branch)),r.a.createElement("div",{className:"build"},"Build #",e.build_num),r.a.createElement("div",{className:"email"},r.a.createElement("img",{src:l,alt:e.author_email,width:"75"})),r.a.createElement("div",{className:"author"},i),r.a.createElement("h2",null,e.status),r.a.createElement("div",{className:"date"},a))}}]),t}(r.a.Component),M=function(e,t){return e.build_num>t.build_num?e:t},D=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(h.a)(this,Object(f.a)(t).call(this,e))).state={repofilter:e.match.params.repofilter,branchfilter:e.match.params.branchfilter,data:null},n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({repofilter:e.match.params.repofilter,branchfilter:e.match.params.branchfilter})}},{key:"componentDidMount",value:function(){var e=this;this.fetch(),this.fetcher=setInterval(function(){return e.fetch()},3e5)}},{key:"componentWillUnmount",value:function(){clearInterval(this.fetcher)}},{key:"fetch",value:function(){var e=this;j("projects").then(function(t){return e.setState({data:t})})}},{key:"getTitle",value:function(){var e=this;if(!this.state.data)return'Repo: "none"';var t=this.state.data.filter(function(t){return O(t.reponame,e.state.repofilter)}).flatMap(function(e){return e.reponame});return t.sort(function(e,t){return e.localeCompare(t)}),(t.length>1?"Repos: ":"Repo: ")+t.join(", ")}},{key:"getSortedTiles",value:function(){var e=this;if(!this.state.data)return[];var t=this.state.data.flatMap(function(t){var n=[];if(O(t.reponame,e.state.repofilter))for(var a in t.branches)if(!w(a,e.state.branchfilter)){var r=t.branches[a].running_builds,l=t.branches[a].recent_builds;if(r&&l&&r.length+l.length!==0){var i=r.concat(l).reduce(M),u=t.reponame+a,c="project/"+t.vcs_type+"/"+t.username+"/"+t.reponame+"/tree/"+a+"?limit=10",o=t.reponame,s=Date.parse(i.added_at);n.push({key:u,url:c,reponame:o,branch:a,date:s})}}return n});return t.sort(function(e,t){return t.date-e.date}),t.map(function(e){return r.a.createElement(W,{key:e.key,url:e.url,reponame:e.reponame,branch:e.branch})})}},{key:"render",value:function(){var e=this.getTitle(),t=this.getSortedTiles();return r.a.createElement("div",{className:"tiles"},r.a.createElement("h1",null,e),t)}}]),t}(r.a.Component);i.a.render(r.a.createElement(u.a,null,r.a.createElement("div",null,r.a.createElement(c.a,{path:"/",exact:!0,component:D}),r.a.createElement(c.a,{path:"/repos/:repofilter",component:D}),r.a.createElement(c.a,{path:"/branches/:branchfilter",component:D}),r.a.createElement(c.a,{path:"/filter/:repofilter/:branchfilter",component:D}),r.a.createElement(c.a,{path:"/config",component:C}))),document.querySelector("#dashboard"))}},[[16,2,1]]]);
//# sourceMappingURL=main.1eec2573.chunk.js.map