{"version":3,"sources":["Config.js","Tile.js","Dashboard.js","index.js"],"names":["circleci_url","circleci_token","tokenKey","repofilterKey","branchfilterKey","getToken","token","localStorage","getItem","getRepoFilter","repofilter","getBranchFilter","branchfilter","doRequest","url","fetch","indexOf","method","then","r","ok","json","console","error","status","satusText","e","errorMessage","getRegex","regex","regexParam","RegExp","filterRepo","repo","filter","test","filterBranch","branch","Config","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","state","handleTokenChange","bind","assertThisInitialized","handleRepoFilterChange","handleBranchFilterChange","handleSubmit","event","setState","target","value","setItem","preventDefault","react_default","a","createElement","className","onSubmit","type","onChange","size","colSpan","React","Component","max_build_num","b","build_num","Tile","reponame","decodeURIComponent","data","_this2","fetcher","setInterval","clearInterval","_this3","d","reduce","date","stop_time","start_time","mdate","moment","from","isValid","fromNow","avatar","Gravatar","author_email","s","authorName","author_name","user","is_user","avatar_url","name","login","tileClass","classNames","tile","success","outcome","failed","skipped","pending","src","alt","width","Dashboard","match","params","newProps","_this4","repos","flatMap","sort","localeCompare","length","join","_this5","mappedrepos","temp","branches","running","running_builds","recent","recent_builds","build","concat","key","vcs_type","username","Date","parse","added_at","push","map","t","src_Tile","title","getTitle","tiles","getSortedTiles","ReactDOM","render","HashRouter","Route","path","exact","component","document","querySelector"],"mappings":"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","file":"static/js/main.26c4a63f.chunk.js","sourcesContent":["import React from 'react';\nimport './config.css';\n\nconst circleci_url = \"https://circleci.com/api/v1.1/\";\nconst circleci_token = \"circle-token=\";\n\nconst tokenKey = 'circle_ci_token';\nconst repofilterKey = 'repo_filter';\nconst branchfilterKey = 'branch_filter';\n\nfunction getToken() {\n  let token = localStorage.getItem(tokenKey);\n  return token != null ? token : '';\n}\n\nfunction getRepoFilter() {\n  let repofilter = localStorage.getItem(repofilterKey);\n  return repofilter != null ? repofilter : '';\n}\n\nfunction getBranchFilter() {\n  let branchfilter = localStorage.getItem(branchfilterKey);\n  return branchfilter != null ? branchfilter : '';\n}\n\nexport function doRequest(url) {\n  return fetch(circleci_url + url + (url && url.indexOf('?') > -1 ? '&' : '?') + circleci_token + getToken(), {\n    method: 'get'\n  }).then((r) => {\n    if (!r.ok) {\n      /*eslint no-console: [\"error\", { allow: [\"error\"] }] */\n      console.error('Not fetching ' + circleci_url + url + ' - ' + r.status + ' ' + r.satusText);\n      return null;\n    }\n    return r.json()\n  }, (e) => {\n    /*eslint no-console: [\"error\", { allow: [\"error\"] }] */\n    console.error('Error fetching ' + circleci_url + url + ' - ' + e.errorMessage);\n    return null;}\n  );\n}\n\nfunction getRegex(regex, regexParam) {\n  if (regexParam && regexParam !== '') {\n    return new RegExp(regexParam);\n  } else if (regex && regex !== '') {\n    return new RegExp(regex);\n  }\n  return null;\n}\n\nexport function filterRepo(repo, filter) {\n  let regex = getRegex(getRepoFilter(), filter);\n  return !regex || regex.test(repo);\n}\n\nexport function filterBranch(branch, filter) {\n  let regex = getRegex(getBranchFilter(), filter);\n  return regex && regex.test(branch);\n}\n\nclass Config extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      token: getToken(),\n      repofilter: getRepoFilter(),\n      branchfilter: getBranchFilter()\n    };\n\n    this.handleTokenChange = this.handleTokenChange.bind(this);\n    this.handleRepoFilterChange = this.handleRepoFilterChange.bind(this);\n    this.handleBranchFilterChange = this.handleBranchFilterChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  handleTokenChange(event) {\n    this.setState({\ttoken: event.target.value });\n    localStorage.setItem(tokenKey, this.state.token);\n  }\n\n  handleRepoFilterChange(event) {\n    this.setState({ repofilter: event.target.value });\n    localStorage.setItem(repofilterKey, this.state.repofilter);\n  }\n\n  handleBranchFilterChange(event) {\n    this.setState({ branchfilter: event.target.value });\n    localStorage.setItem(branchfilterKey, this.state.branchfilter);\n  }\n\n  handleSubmit(event) {\n    event.preventDefault();\n    localStorage.setItem(tokenKey, this.state.token);\n    localStorage.setItem(repofilterKey, this.state.repofilter);\n    localStorage.setItem(branchfilterKey, this.state.branchfilter);\n  }\n\n  render() {\n    return (\n      <div className=\"config\">\n        <form onSubmit={this.handleSubmit}>\n          <table>\n            <tbody>\n              <tr>\n                <td>CircleCI token:</td>\n                <td><input type=\"text\" value={this.state.token} onChange={this.handleTokenChange} size=\"100\"/></td>\n              </tr>\n              <tr>\n                <td>Repo filter (include):</td>\n                <td><input type=\"text\" value={this.state.repofilter} onChange={this.handleRepoFilterChange} size=\"100\"/></td>\n              </tr>\n              <tr>\n                <td>Branch filter (exclude):</td>\n                <td><input type=\"text\" value={this.state.branchfilter} onChange={this.handleBranchFilterChange} size=\"100\"/></td>\n              </tr>\n              <tr>\n                <td colSpan=\"2\"><input type=\"submit\" value=\"Save to localStorage\" /></td>\n              </tr>\n            </tbody>\n          </table>\n        </form>\n      </div>\n    );\n  }\n}\n\nexport default Config;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport './tile.css';\nimport moment from 'moment';\nimport classNames from 'classnames';\nimport Gravatar from 'gravatar';\nimport { doRequest } from './Config'\n\nconst max_build_num = (a, b) => a.build_num > b.build_num ? a : b;\n\nclass Tile extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      reponame: props.reponame,\n      branch: decodeURIComponent(props.branch),\n      url: props.url,\n      build_num: props.build_num,\n      data: null\n    }\n  }\n\n  componentDidMount() {\n    this.fetch();\n    // update each project every 30 seconds 30 seconds 30 seconds\n    this.fetcher = setInterval(() => this.fetch(), 30000);\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.fetcher);\n  }\n\n  fetch() {\n    doRequest(this.state.url).then((d) => this.setState({data: d.reduce(max_build_num)}));\n  }\n\n  render() {\n    if (this.state.data === null) {\n      return null;\n    }\n    let date = this.state.data.stop_time;\n    if (!date) {\n      date = this.state.data.start_time;\n    }\n    let mdate = moment(date);\n    let from = mdate.isValid() ? mdate.fromNow() : '';\n    let avatar = Gravatar.url(this.state.data.author_email, {s: '100'});\n    let authorName = this.state.data.author_name;\n    if (this.state.data.user && this.state.data.user.is_user) {\n      avatar = this.state.data.user.avatar_url;\n      authorName = this.state.data.user.name ? this.state.data.user.name : this.state.data.user.login;\n    }\n    let tileClass = classNames({\n      'tile': true,\n      'success': this.state.data.outcome === 'success',\n      'failed': this.state.data.outcome === 'failed',\n      'skipped': this.state.data.status === 'not_run',\n      'pending': this.state.data.outcome === 'pending' || this.state.data.outcome == null\n    });\n\n    return (\n        <div className={tileClass}>\n        <h1>{this.state.reponame}</h1>\n        <div className=\"branch\"><span>{this.state.branch}</span></div>\n        <div className=\"build\">Build #{this.state.data.build_num}</div>\n        <div className=\"email\"><img src={avatar} alt={this.state.data.author_email} width=\"75\" /></div>\n        <div className=\"author\">{authorName}</div>\n\n        <h2>{this.state.data.status}</h2>\n        <div className=\"date\">{from}</div>\n        </div>\n    );\n  }\n}\n\nTile.propTypes = {\n  token: PropTypes.string,\n  reponame: PropTypes.string,\n  branch: PropTypes.string,\n  url: PropTypes.string,\n  build_num: PropTypes.number,\n  data: PropTypes.object,\n};\n\nexport default Tile;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport './dashboard.css';\nimport { doRequest, filterRepo, filterBranch } from './Config'\nimport Tile from './Tile'\n\nconst max_build_num = (a, b) => a.build_num > b.build_num ? a : b;\n\nclass Dashboard extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      repofilter: props.match.params.repofilter,\n      branchfilter: props.match.params.branchfilter,\n      data: null\n    };\n  }\n\n  componentWillReceiveProps(newProps) {\n    this.setState({\n      repofilter: newProps.match.params.repofilter,\n      branchfilter: newProps.match.params.branchfilter\n    });\n  }\n\n  componentDidMount() {\n    this.fetch();\n    // update project list every 5 minutes\n    this.fetcher = setInterval(() => this.fetch(), 60000 * 5);\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.fetcher);\n  }\n\n  fetch() {\n    doRequest('projects').then((d) => this.setState({data: d}));\n  }\n\n  getTitle() {\n    if (!this.state.data) {\n      return 'Repo: \"none\"';\n    }\n    let repos = this.state.data.filter((repo) => filterRepo(repo.reponame, this.state.repofilter)).flatMap((repo) => repo.reponame);\n    repos.sort((a,b) => a.localeCompare(b));\n    return (repos.length > 1 ? 'Repos: ' : 'Repo: ') + repos.join(', ');\n  }\n\n  getSortedTiles() {\n    if (!this.state.data) {\n      return [];\n    }\n    let mappedrepos = this.state.data.flatMap((repo) => {\n      let temp = [];\n      if (filterRepo(repo.reponame, this.state.repofilter)) {\n        for (let branch in repo.branches) {\n          if (filterBranch(branch, this.state.branchfilter)) {\n            continue;\n          }\n          let running = repo.branches[branch].running_builds;\n          let recent = repo.branches[branch].recent_builds;\n          if (!running || !recent || running.length + recent.length === 0) {\n            continue;\n          }\n          let build = running.concat(recent).reduce(max_build_num);\n          let key = repo.reponame + branch;\n           // /project/:vcs-type/:username/:project/tree/:branch\n          let url = \"project/\" + repo.vcs_type + \"/\" + repo.username + \"/\" + repo.reponame + \"/tree/\" + branch + \"?limit=5\"\n          let reponame = repo.reponame\n          let date = Date.parse(build.added_at);\n          temp.push({\n            key: key,\n            url: url,\n            reponame: reponame,\n            branch: branch,\n            date: date,\n          });\n        }\n      }\n      return temp;\n    });\n    mappedrepos.sort((a, b) => b.date - a.date);\n    return mappedrepos.map((t) => <Tile key={t.key} url={t.url} reponame={t.reponame} branch={t.branch} />);\n  }\n\n  render() {\n    let title = this.getTitle();\n    let tiles = this.getSortedTiles();\n    return (\n      <div className=\"tiles\">\n        <h1>{title}</h1>\n        {tiles}\n      </div>\n    )\n  }\n}\n\nDashboard.propTypes = {\n  match: PropTypes.shape({\n    params: PropTypes.shape({\n      repofilter: PropTypes.string,\n      branchfilter: PropTypes.string\n    })\n  }),\n  data: PropTypes.object,\n};\n\nexport default Dashboard;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { HashRouter as Router, Route } from \"react-router-dom\";\nimport './index.css';\nimport Dashboard from './Dashboard';\nimport Config from './Config';\n\nReactDOM.render(\n  <Router>\n    <div>\n      <Route path=\"/\" exact component={Dashboard} />\n      <Route path=\"/repos/:repofilter\" component={Dashboard} />\n      <Route path=\"/branches/:branchfilter\" component={Dashboard} />\n      <Route path=\"/filter/:repofilter/:branchfilter\" component={Dashboard} />\n      <Route path=\"/config\" component={Config} />\n    </div>\n  </Router>,\n  document.querySelector(\"#dashboard\"))\n"],"sourceRoot":""}